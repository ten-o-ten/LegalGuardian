# LegalGuardian - Юридический Telegram бот

LegalGuardian - это бот для Telegram, который помогает отвечать на юридические вопросы, основываясь на российском законодательстве. Бот использует индексированную базу правовых документов и модель машинного обучения Gemma-3 для генерации точных и информативных ответов.

## Возможности

- Поиск релевантной информации в правовых документах с использованием индекса FAISS
- Генерация ответов с помощью языковой модели (Gemma-3)
- Сохранение контекста разговора для адекватных ответов на последующие вопросы
- Цитирование источников информации в ответах
- Расширение запросов для улучшения поиска
- Умное определение юридических вопросов

## Структура проекта

```
LegalGuardian/
├── telegram_bot/           # Основной модуль бота
│   ├── __init__.py         # Инициализация пакета
│   ├── bot.py              # Логика Telegram бота
│   ├── retriever.py        # Поиск релевантной информации
│   ├── generator.py        # Генерация ответов
│   ├── memory.py           # Управление памятью диалогов
│   └── local_run.py        # Локальный запуск бота
├── notebooks/              # Jupyter ноутбуки
│   ├── create_index.ipynb  # Ноутбук для создания индекса
│   └── test.ipynb          # Тестовый ноутбук для проверки работы модели
├── data/                   # Директория для хранения данных
│   ├── json/               # JSON файлы с правовыми документами
│   ├── legal_index.faiss   # Индекс FAISS (создается через ноутбук)
│   └── chunks_references.pkl # Данные чанков (создается через ноутбук)
├── scripts/                # Вспомогательные скрипты
│   └── run_bot.py          # Скрипт для запуска бота
├── .env                    # Файл с переменными окружения
├── .env.example            # Пример файла с переменными окружения
├── .gitignore              # Файлы, исключенные из репозитория
├── requirements.txt        # Зависимости проекта
└── README.md               # Документация проекта
```

## Необходимые компоненты

- Python 3.9+
- Telegram бот (создается через @BotFather)
- Аккаунт на Hugging Face и токен API для доступа к моделям
- Индексированные правовые данные (создаются с помощью ноутбука)

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/LegalGuardian.git
   cd LegalGuardian
   ```

2. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # На Windows: venv\Scripts\activate
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

4. Подготовьте файл с переменными окружения:
   ```bash
   cp .env.example .env
   # Отредактируйте .env, добавив свои API токены и пути к файлам
   ```

## Конфигурация

Отредактируйте файл `.env` и укажите следующие параметры:

- `TELEGRAM_TOKEN`: Токен вашего Telegram бота (от @BotFather)
- `HUGGINGFACE_TOKEN`: Токен Hugging Face для доступа к модели
- `INDEX_PATH`: Путь к индексу FAISS
- `CHUNKS_DATA_PATH`: Путь к данным чанков
- `MAX_HISTORY`: Максимальное количество сообщений в истории диалога (по умолчанию 8)
- `MAX_CHUNKS`: Максимальное количество чанков для ответа (по умолчанию 5)
- `MAX_TOKENS`: Максимальное количество токенов в ответе (по умолчанию 1024)
- `TEMPERATURE`: Температура генерации (по умолчанию 0.7)
- `TOP_P`: Параметр top_p для генерации (по умолчанию 0.9)
- `LEGAL_DATA_PATH`: Путь к JSON-файлу с правовыми документами

## Создание индекса

Прежде чем запустить бота, необходимо создать индекс из правовых документов. Для этого используйте Jupyter ноутбук:

```bash
jupyter notebook notebooks/create_index.ipynb
```

Следуйте инструкциям в ноутбуке для создания индекса из файла с правовыми документами в формате JSON.

## Запуск бота

### Через скрипт run_bot.py

```bash
python scripts/run_bot.py
```

### Через модуль local_run.py

```bash
python -m telegram_bot.local_run
```

## Использование

1. Найдите вашего бота в Telegram по его имени
2. Нажмите "Start" или отправьте команду `/start`
3. Задайте юридический вопрос
4. Бот ответит на ваш вопрос, используя информацию из правовых документов

### Команды бота

- `/start` - Начать разговор с ботом
- `/help` - Показать справку
- `/clear` - Очистить историю разговора

## Форматирование кода

```bash
black .
```

## Лицензия

MIT

## Благодарности

В разработке бота использованы следующие технологии и модели:

- **Языковые модели**:
  - [Gemma-3 от Google](https://huggingface.co/google/gemma-3-4b-it) - мощная языковая модель для генерации высококачественных ответов на юридические вопросы
  
- **Модели эмбеддингов**:
  - [Multilingual E5 от Microsoft](https://huggingface.co/intfloat/multilingual-e5-small) - модель для создания семантических эмбеддингов текста на разных языках, включая русский
  
- **Библиотеки и фреймворки**:
  - [FAISS от Facebook Research](https://github.com/facebookresearch/faiss) - эффективная библиотека для векторного поиска и кластеризации
  - [Hugging Face Transformers](https://huggingface.co/docs/transformers/index) - экосистема предобученных моделей и инструментов для их использования
  - [python-telegram-bot](https://github.com/python-telegram-bot/python-telegram-bot) - Python-обертка для Telegram Bot API
  - [PyTorch](https://pytorch.org/) - фреймворк для машинного обучения
  
- **Данные**:
  - Корпус российских правовых документов, структурированный для эффективного поиска 